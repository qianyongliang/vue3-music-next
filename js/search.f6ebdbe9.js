(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["search"],{"1ef7":function(e,t,n){"use strict";n.r(t);var r=n("7a23"),c=function(e){return Object(r["B"])("data-v-1f517b37"),e=e(),Object(r["z"])(),e},o={class:"search"},i={class:"search-input-wrapper"},a={class:"hot-keys"},s=c((function(){return Object(r["k"])("h1",{class:"title"},"热门搜索",-1)})),u=["onClick"],l={class:"search-history"},f={class:"title"},p=c((function(){return Object(r["k"])("span",{class:"text"},"搜索历史",-1)})),b=c((function(){return Object(r["k"])("i",{class:"icon-clear"},null,-1)})),h=[b],d={class:"search-result"};function j(e,t,n,c,b,j){var O=Object(r["G"])("search-input"),v=Object(r["G"])("confirm"),m=Object(r["G"])("search-list"),y=Object(r["G"])("scroll"),g=Object(r["G"])("suggest"),k=Object(r["G"])("router-view");return Object(r["y"])(),Object(r["j"])("div",o,[Object(r["k"])("div",i,[Object(r["l"])(O,{modelValue:e.query,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.query=t})},null,8,["modelValue"])]),Object(r["S"])(Object(r["l"])(y,{ref:"scrollRef",class:"search-content"},{default:Object(r["R"])((function(){return[Object(r["k"])("div",null,[Object(r["k"])("div",a,[s,Object(r["k"])("ul",null,[(Object(r["y"])(!0),Object(r["j"])(r["a"],null,Object(r["E"])(e.hotKeys,(function(t){return Object(r["y"])(),Object(r["j"])("li",{class:"item",key:t.id,onClick:function(n){return e.addQuery(t.key)}},[Object(r["k"])("span",null,Object(r["K"])(t.key),1)],8,u)})),128))])]),Object(r["S"])(Object(r["k"])("div",l,[Object(r["k"])("h1",f,[p,Object(r["k"])("span",{class:"clear",onClick:t[1]||(t[1]=function(){return e.showConfirm&&e.showConfirm.apply(e,arguments)})},h)]),Object(r["l"])(v,{ref:"confirmRef",text:"是否清空所有搜索历史","confirm-btn-text":"清空",onConfirm:e.clearSearch},null,8,["onConfirm"]),Object(r["l"])(m,{searches:e.searchHistory,onSelect:e.addQuery,onDelete:e.deleteSearch},null,8,["searches","onSelect","onDelete"])],512),[[r["P"],e.searchHistory.length]])])]})),_:1},512),[[r["P"],!e.query]]),Object(r["S"])(Object(r["k"])("div",d,[Object(r["l"])(g,{query:e.query,onSelectSong:e.selectSong,onSelectSinger:e.selectSinger},null,8,["query","onSelectSong","onSelectSinger"])],512),[[r["P"],e.query]]),Object(r["l"])(k,null,{default:Object(r["R"])((function(t){var n=t.Component;return[Object(r["l"])(r["d"],{appear:"",name:"slide"},{default:Object(r["R"])((function(){return[(Object(r["y"])(),Object(r["h"])(Object(r["I"])(n),{data:e.selectedSinger},null,8,["data"]))]})),_:2},1024)]})),_:1})])}var O=n("5530"),v=n("1da1"),m=(n("96cf"),n("5502")),y=n("6c02"),g=(n("d3b7"),n("2ff6")),k=function(){return new Promise((function(e,t){Object(g["a"])("/api/getHotKeys").then((function(t){e(t)})).catch((function(e){t(e)}))}))},w=function(e,t,n){return new Promise((function(r,c){Object(g["a"])("/api/search",{query:e,page:t,showSinger:n}).then((function(e){r(e)})).catch((function(e){c(e)}))}))},S=n("f2a5"),x=n("c81b"),R=n("bbb3"),P=function(){var e=200,t=Object(m["f"])(),n=function(n){var r=Object(S["e"])(n,x["d"],(function(e){return e===n}),e);t.commit(R["g"],r)},r=function(e){var n=Object(S["d"])(x["d"],(function(t){return t===e}));t.commit(R["g"],n)},c=function(){var e=Object(S["b"])(x["d"]);t.commit(R["g"],e)};return{saveSearch:n,deleteSearch:r,clearSearch:c}},U=P,D=function(e){return Object(r["B"])("data-v-17ef5ab2"),e=e(),Object(r["z"])(),e},T={class:"search-input"},C=D((function(){return Object(r["k"])("i",{class:"icon-search"},null,-1)})),q=["placeholder"];function _(e,t,n,c,o,i){return Object(r["y"])(),Object(r["j"])("div",T,[C,Object(r["S"])(Object(r["k"])("input",{class:"input-inner","onUpdate:modelValue":t[0]||(t[0]=function(t){return e.query=t}),placeholder:e.placeholder},null,8,q),[[r["O"],e.query]]),Object(r["S"])(Object(r["k"])("i",{class:"icon-dismiss",onClick:t[1]||(t[1]=function(){return e.clear&&e.clear.apply(e,arguments)})},null,512),[[r["P"],e.query]])])}n("498a");function B(e,t,n,r){var c,o=!1,i=0;function a(){c&&clearTimeout(c)}function s(){a(),o=!0}function u(){for(var s=arguments.length,u=new Array(s),l=0;l<s;l++)u[l]=arguments[l];var f=this,p=Date.now()-i;function b(){i=Date.now(),n.apply(f,u)}function h(){c=void 0}o||(r&&!c&&b(),a(),void 0===r&&p>e?b():!0!==t&&(c=setTimeout(r?h:b,void 0===r?e-p:e)))}return"boolean"!==typeof t&&(r=n,n=t,t=void 0),u.cancel=s,u}function L(e,t,n){return void 0===n?B(e,t,!1):B(e,n,!1!==t)}var K=Object(r["m"])({name:"search-input",props:{modelValue:String,placeholder:{type:String,default:"搜索歌曲、歌手"}},setup:function(e,t){var n=t.emit,c=Object(r["D"])(e.modelValue),o=function(){c.value=""};return Object(r["Q"])((function(){return e.modelValue}),(function(e){c.value=e})),Object(r["Q"])((function(){return c.value}),L(500,(function(e){n("update:modelValue",e.trim())}))),{query:c,clear:o}}}),H=(n("74d5"),n("d959")),I=n.n(H);const E=I()(K,[["render",_],["__scopeId","data-v-17ef5ab2"]]);var M=E,V=function(e){return Object(r["B"])("data-v-05a37a71"),e=e(),Object(r["z"])(),e},Q={class:"search-list"},Y=["onClick"],z={class:"text"},G=["onClick"],A=V((function(){return Object(r["k"])("i",{class:"icon-delete"},null,-1)})),F=[A];function $(e,t,n,c,o,i){return Object(r["y"])(),Object(r["j"])("div",Q,[Object(r["l"])(r["e"],{name:"list",tag:"ul"},{default:Object(r["R"])((function(){return[(Object(r["y"])(!0),Object(r["j"])(r["a"],null,Object(r["E"])(e.searches,(function(t){return Object(r["y"])(),Object(r["j"])("li",{key:t,class:"search-item",onClick:function(n){return e.selectItem(t)}},[Object(r["k"])("span",z,Object(r["K"])(t),1),e.showDelete?(Object(r["y"])(),Object(r["j"])("span",{key:0,class:"icon",onClick:Object(r["T"])((function(n){return e.deleteItem(t)}),["stop"])},F,8,G)):Object(r["i"])("",!0)],8,Y)})),128))]})),_:1})])}var J=Object(r["m"])({name:"search-list",props:{searches:{type:Array,default:function(){return[]}},showDelete:{type:Boolean,default:!0}},emits:["select","delete"],setup:function(e,t){var n=t.emit,r=function(e){n("select",e)},c=function(e){n("delete",e)};return{selectItem:r,deleteItem:c}}});n("b381");const N=I()(J,[["render",$],["__scopeId","data-v-05a37a71"]]);var W=N,X={class:"confirm"},Z={class:"confirm-wrapper"},ee={class:"confirm-content"},te={class:"text"},ne={class:"operate"};function re(e,t,n,c,o,i){return Object(r["y"])(),Object(r["h"])(r["c"],{to:"body"},[Object(r["l"])(r["d"],{name:"confirm-fade"},{default:Object(r["R"])((function(){return[Object(r["S"])(Object(r["k"])("div",X,[Object(r["k"])("div",Z,[Object(r["k"])("div",ee,[Object(r["k"])("p",te,Object(r["K"])(e.text),1),Object(r["k"])("div",ne,[Object(r["k"])("div",{class:"operate-btn left",onClick:t[0]||(t[0]=function(){return e.confirm&&e.confirm.apply(e,arguments)})},Object(r["K"])(e.confirmBtnText),1),Object(r["k"])("div",{class:"operate-btn",onClick:t[1]||(t[1]=function(){return e.cancel&&e.cancel.apply(e,arguments)})},Object(r["K"])(e.cancelBtnText),1)])])])],512),[[r["P"],e.visible]])]})),_:1})])}var ce=Object(r["m"])({name:"confirm",props:{text:{type:String,default:""},confirmBtnText:{type:String,default:"确定"},cancelBtnText:{type:String,default:"取消"}},emits:["confirm","cancel"],setup:function(e,t){var n=t.emit,c=Object(r["D"])(!1),o=function(){a(),n("confirm")},i=function(){a(),n("cancel")},a=function(){c.value=!1},s=function(){c.value=!0};return{visible:c,confirm:o,cancel:i,hide:a,show:s}}});n("cf7c");const oe=I()(ce,[["render",re],["__scopeId","data-v-4a9b8466"]]);var ie=oe,ae=n("953a"),se=(n("b0c0"),function(e){return Object(r["B"])("data-v-514ac2cc"),e=e(),Object(r["z"])(),e}),ue={ref:"rootRef",class:"suggest"},le={class:"suggest-list"},fe=se((function(){return Object(r["k"])("div",{class:"icon"},[Object(r["k"])("i",{class:"icon-mine"})],-1)})),pe={class:"name"},be={class:"text"},he=["onClick"],de=se((function(){return Object(r["k"])("div",{class:"icon"},[Object(r["k"])("i",{class:"icon-music"})],-1)})),je={class:"name"},Oe={class:"text"},ve={class:"suggest-item"};function me(e,t,n,c,o,i){var a=Object(r["H"])("loading"),s=Object(r["H"])("no-result");return Object(r["S"])((Object(r["y"])(),Object(r["j"])("div",ue,[Object(r["k"])("ul",le,[e.singer?(Object(r["y"])(),Object(r["j"])("li",{key:0,class:"suggest-item",onClick:t[0]||(t[0]=function(t){return e.selectSinger(e.singer)})},[fe,Object(r["k"])("div",pe,[Object(r["k"])("p",be,Object(r["K"])(e.singer.name),1)])])):Object(r["i"])("",!0),(Object(r["y"])(!0),Object(r["j"])(r["a"],null,Object(r["E"])(e.songs,(function(t){return Object(r["y"])(),Object(r["j"])("li",{class:"suggest-item",key:t.id,onClick:function(n){return e.selectSong(t)}},[de,Object(r["k"])("div",je,[Object(r["k"])("p",Oe,Object(r["K"])(t.singer)+"-"+Object(r["K"])(t.name),1)])],8,he)})),128)),Object(r["S"])(Object(r["k"])("div",ve,null,512),[[a,e.pullUpLoading,e.loadingText]])])])),[[a,e.loading,e.loadingText],[s,e.noResult,e.noResultText]])}n("99af");var ye=n("081a"),ge=n("229e"),ke="undefined"!==typeof window,we=ke&&navigator.userAgent.toLowerCase();we&&/wechatdevtools/.test(we),we&&we.indexOf("android"),function(){if("string"===typeof we){var e=/os (\d\d?_\d(_\d)?)/,t=e.exec(we);if(!t)return!1;var n=t[1].split("_").map((function(e){return parseInt(e,10)}));return!!(13===n[0]&&n[1]>=4)}}();if(ke){var Se="test-passive";try{var xe={};Object.defineProperty(xe,"passive",{get:function(){!0}}),window.addEventListener(Se,(function(){}),xe)}catch(ze){}}var Re=function(e,t){for(var n in t)e[n]=t[n];return e},Pe=ke&&document.createElement("div").style,Ue=function(){if(!ke)return!1;for(var e=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}],t=0,n=e;t<n.length;t++){var r=n[t];if(void 0!==Pe[r.value])return r.key}return!1}();function De(e){return!1===Ue?e:"standard"===Ue?"transitionEnd"===e?"transitionend":e:Ue+e.charAt(0).toUpperCase()+e.substr(1)}Ue&&"standard"!==Ue&&Ue.toLowerCase();De("transform"),De("transition");ke&&De("perspective"),De("transitionTimingFunction"),De("transitionDuration"),De("transitionDelay"),De("transformOrigin"),De("transitionEnd"),De("transitionProperty");var Te="plugins.pullUpLoad",Ce=[{key:"finishPullUp",name:"finishPullUp"},{key:"openPullUp",name:"openPullUp"},{key:"closePullUp",name:"closePullUp"},{key:"autoPullUpLoad",name:"autoPullUpLoad"}],qe=Ce.map((function(e){return{key:e.key,sourceKey:Te+"."+e.name}})),_e="pullingUp",Be=function(){function e(e){this.scroll=e,this.pulling=!1,this.watching=!1,this.init()}return e.prototype.init=function(){this.handleBScroll(),this.handleOptions(this.scroll.options.pullUpLoad),this.handleHooks(),this.watch()},e.prototype.handleBScroll=function(){this.scroll.registerType([_e]),this.scroll.proxy(qe)},e.prototype.handleOptions=function(e){void 0===e&&(e={}),e=!0===e?{}:e;var t={threshold:0};this.options=Re(t,e),this.scroll.options.probeType=3},e.prototype.handleHooks=function(){var e=this;this.hooksFn=[];var t=this.scroll.scroller.scrollBehaviorY;this.registerHooks(this.scroll.hooks,this.scroll.hooks.eventTypes.contentChanged,(function(){e.finishPullUp()})),this.registerHooks(t.hooks,t.hooks.eventTypes.computeBoundary,(function(e){e.maxScrollPos>0&&(e.maxScrollPos=-1)}))},e.prototype.registerHooks=function(e,t,n){e.on(t,n,this),this.hooksFn.push([e,t,n])},e.prototype.watch=function(){this.watching||(this.watching=!0,this.registerHooks(this.scroll,this.scroll.eventTypes.scroll,this.checkPullUp))},e.prototype.unwatch=function(){this.watching=!1,this.scroll.off(this.scroll.eventTypes.scroll,this.checkPullUp)},e.prototype.checkPullUp=function(e){var t=this,n=this.options.threshold;1===this.scroll.movingDirectionY&&e.y<=this.scroll.maxScrollY+n&&(this.pulling=!0,this.scroll.once(this.scroll.eventTypes.scrollEnd,(function(){t.pulling=!1})),this.unwatch(),this.scroll.trigger(_e))},e.prototype.finishPullUp=function(){var e=this;this.scroll.scroller.scrollBehaviorY.setMovingDirection(0),this.pulling?this.scroll.once(this.scroll.eventTypes.scrollEnd,(function(){e.watch()})):this.watch()},e.prototype.openPullUp=function(e){void 0===e&&(e={}),this.handleOptions(e),this.watch()},e.prototype.closePullUp=function(){this.unwatch()},e.prototype.autoPullUpLoad=function(){var e=this.options.threshold,t=this.scroll.scroller.scrollBehaviorY;if(!this.pulling&&this.watching){var n=-1,r=t.maxScrollPos+e+n;this.scroll.scroller.scrollBehaviorY.setMovingDirection(n),this.scroll.scrollTo(this.scroll.x,r,this.scroll.options.bounceTime)}},e.pluginName="pullUpLoad",e}(),Le=Be,Ke=n("2bb4");ge["a"].use(Le),ge["a"].use(Ke["a"]);var He=function(e,t){var n=Object(r["D"])(null),c=Object(r["D"])(null),o=Object(r["D"])(!1);return Object(r["w"])((function(){var r=n.value=new ge["a"](c.value,{pullUpLoad:!0,observeDOM:!0,click:!0}),i=function(){var n=Object(v["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.value){n.next=3;break}return r.finishPullUp(),n.abrupt("return");case 3:return o.value=!0,n.next=6,e();case 6:r.finishPullUp(),r.refresh(),o.value=!1;case 9:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();r.on("pullingUp",i)})),Object(r["x"])((function(){n.value.destroy()})),Object(r["u"])((function(){n.value.enable(),n.value.refresh()})),Object(r["v"])((function(){n.value.disable()})),{scroll:n,rootRef:c,isPullUpLoad:o}},Ie=He,Ee=Object(r["m"])({name:"suggest",props:{query:String,showSinger:{type:Boolean,default:!0}},emits:["select-song","select-singer"],setup:function(e,t){var n=t.emit,c=Object(r["D"])([]),o=Object(r["D"])(null),i=Object(r["D"])(!0),a=Object(r["D"])(1),s=Object(r["D"])(""),u=Object(r["D"])("抱歉，暂无搜索结果"),l=Object(r["D"])(!1),f=Object(r["f"])((function(){return!o.value&&!c.value.length})),p=Object(r["f"])((function(){return!o.value&&!c.value.length&&!i.value})),b=Object(r["f"])((function(){return j.value&&i.value})),h=Object(r["f"])((function(){return f.value||l.value})),d=Ie(g,h),j=d.isPullUpLoad,O=d.rootRef,m=d.scroll;Object(r["Q"])((function(){return e.query}),function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,y();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var y=function(){var t=Object(v["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.query){t.next=2;break}return t.abrupt("return");case 2:return a.value=1,c.value=[],o.value=null,i.value=!0,t.next=8,w(e.query,a.value,e.showSinger);case 8:return n=t.sent,t.next=11,Object(ye["b"])(n.songs);case 11:return c.value=t.sent,o.value=n.singer,i.value=n.hasMore,t.next=16,Object(r["r"])();case 16:return t.next=18,S();case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function g(){return k.apply(this,arguments)}function k(){return k=Object(v["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i.value&&e.query){t.next=2;break}return t.abrupt("return");case 2:return a.value++,t.next=5,w(e.query,a.value,e.showSinger);case 5:return n=t.sent,t.t0=c.value,t.next=9,Object(ye["b"])(n.songs);case 9:return t.t1=t.sent,c.value=t.t0.concat.call(t.t0,t.t1),i.value=n.hasMore,t.next=14,Object(r["r"])();case 14:return t.next=17,S();case 17:case"end":return t.stop()}}),t)}))),k.apply(this,arguments)}var S=function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(m.value.maxScrollY>=-1)){e.next=5;break}return l.value=!0,e.next=4,g();case 4:l.value=!1;case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(e){n("select-singer",e)},R=function(e){n("select-song",e)};return{songs:c,singer:o,loadingText:s,pullUpLoading:b,noResultText:u,loading:f,noResult:p,selectSinger:x,selectSong:R,rootRef:O}}});n("f4fe");const Me=I()(Ee,[["render",me],["__scopeId","data-v-514ac2cc"]]);var Ve=Me,Qe=Object(r["m"])({name:"search",components:{SearchInput:M,SearchList:W,Confirm:ie,Scroll:ae["a"],Suggest:Ve},setup:function(){var e=Object(m["f"])(),t=Object(y["d"])(),n=Object(r["f"])((function(){return e.state.searchHistory})),c=Object(r["C"])({hotKeys:[],query:""}),o=Object(r["D"])(null),i=Object(r["D"])(null),a=Object(r["D"])(null),s=U(),u=s.saveSearch,l=s.deleteSearch,f=s.clearSearch,p=function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:t=e.sent,c.hotKeys=null===t||void 0===t?void 0:t.hotKeys;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();p(),Object(r["Q"])((function(){return c.query}),function(){var e=Object(v["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.next=3,Object(r["r"])();case 3:b();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var b=function(){o.value.scroll.refresh()},h=function(e){c.query=e},d=function(e){u(c.query)},j=function(e){u(c.query),a.value=e,Object(S["a"])(x["e"],e),t.push({path:"/search/".concat(e.mid)})},g=function(){i.value.show()};return Object(O["a"])(Object(O["a"])({},Object(r["M"])(c)),{},{searchHistory:n,scrollRef:o,confirmRef:i,selectedSinger:a,addQuery:h,showConfirm:g,deleteSearch:l,clearSearch:f,selectSong:d,selectSinger:j})}});n("ef34");const Ye=I()(Qe,[["render",j],["__scopeId","data-v-1f517b37"]]);t["default"]=Ye},2806:function(e,t,n){},"42f8":function(e,t,n){},"498a":function(e,t,n){"use strict";var r=n("23e7"),c=n("58a8").trim,o=n("c8d2");r({target:"String",proto:!0,forced:o("trim")},{trim:function(){return c(this)}})},"74d5":function(e,t,n){"use strict";n("c06f")},"953a":function(e,t,n){"use strict";var r=n("7a23"),c=n("bba4");t["a"]={name:"wrap-scroll",props:c["a"].props,emits:c["a"].emits,render:function(e){return Object(r["o"])(c["a"],Object(r["q"])({ref:"scrollRef"},e.$props,{onScroll:function(t){e.$emit("scroll",t)}}),{default:Object(r["R"])((function(){return[Object(r["F"])(e.$slots,"default")]}))})},setup:function(){var e=Object(r["D"])(null),t=Object(r["f"])((function(){return e.value.scroll}));return{scrollRef:e,scroll:t}}}},b381:function(e,t,n){"use strict";n("2806")},c06f:function(e,t,n){},c8d2:function(e,t,n){var r=n("5e77").PROPER,c=n("d039"),o=n("5899"),i="​᠎";e.exports=function(e){return c((function(){return!!o[e]()||i[e]()!==i||r&&o[e].name!==e}))}},cf7c:function(e,t,n){"use strict";n("42f8")},d576:function(e,t,n){},e483:function(e,t,n){},ef34:function(e,t,n){"use strict";n("e483")},f4fe:function(e,t,n){"use strict";n("d576")}}]);
//# sourceMappingURL=search.f6ebdbe9.js.map